<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PDF Analytics Dashboard</title>
	<link rel="stylesheet" href="/dashboard/css/styles.css">
</head>
<body>
	<!-- Login Page -->
	<div id="login-page" class="login-container">
		<div class="login-card card">
			<div class="card-header">
				<h2 class="card-title">PDF Analytics Dashboard</h2>
				<p class="card-description">Digite o token de autenticaÃ§Ã£o para acessar</p>
			</div>
			<div class="card-content">
				<form id="login-form">
					<div class="form-group">
						<label for="token-input" class="form-label">API Token</label>
						<input
							type="password"
							id="token-input"
							class="input"
							placeholder="Digite o token (mÃ­nimo 32 caracteres)"
							required
							minlength="32"
						>
					</div>
					<div id="login-error" class="error hidden"></div>
					<button type="submit" class="btn btn-primary" style="width: 100%;">
						Entrar
					</button>
				</form>
			</div>
		</div>
	</div>

	<!-- Dashboard -->
	<div id="dashboard" class="hidden">
		<!-- Header -->
		<header class="header">
			<div class="container">
				<div class="header-content">
					<h1>PDF Analytics Dashboard</h1>
					<button id="logout-btn" class="btn btn-secondary">Sair</button>
				</div>
			</div>
		</header>

		<!-- Tabs -->
		<nav class="tabs">
			<div class="container">
				<ul class="tabs-list">
					<li>
						<button class="tab-trigger active" data-tab="overview">
							VisÃ£o Geral
						</button>
					</li>
					<li>
						<button class="tab-trigger" data-tab="top-urls">
							URLs Mais Acessadas
						</button>
					</li>
					<li>
						<button class="tab-trigger" data-tab="errors">
							Rastreamento de Erros
						</button>
					</li>
					<li>
						<button class="tab-trigger" data-tab="downloads">
							Downloads
						</button>
					</li>
					<li>
						<button class="tab-trigger" data-tab="processing">
							Processamento de PDFs
						</button>
					</li>
					<li>
						<button class="tab-trigger" data-tab="apps">
							Apps (API Tokens)
						</button>
					</li>
				</ul>
			</div>
		</nav>

		<!-- Content -->
		<main class="container">
			<!-- Overview Tab -->
			<div id="overview-tab" class="tab-panel active">
				<div class="tab-content">
					<div class="flex items-center justify-between mb-4">
						<h2 style="font-size: 1.5rem; font-weight: 600;">EstatÃ­sticas de Downloads</h2>
						<button id="overview-refresh-btn" class="btn btn-secondary">
							Atualizar
						</button>
					</div>

					<div id="overview-loading" class="loading">
						<div class="loading-spinner"></div>
						<span style="margin-left: 0.5rem;">Carregando...</span>
					</div>

					<div id="overview-error" class="error hidden"></div>

					<div id="overview-content" class="hidden">
						<div class="stats-grid" id="stats-grid"></div>

						<div class="card">
							<div class="card-header">
								<div class="flex items-center justify-between">
									<h3 class="card-title">TendÃªncia de Downloads</h3>
									<div class="flex items-center gap-2">
										<label for="chart-grouping" style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
											Agrupar por:
										</label>
										<select id="chart-grouping" class="select">
											<option value="hour">Hora</option>
											<option value="day">Dia</option>
											<option value="week" selected>Semana</option>
											<option value="month">MÃªs</option>
										</select>
									</div>
								</div>
							</div>
							<div class="card-content">
								<div style="position: relative; height: 400px;">
									<canvas id="downloads-chart"></canvas>
								</div>
							</div>
						</div>

						<div class="card mt-2">
							<div class="card-header">
								<h3 class="card-title">Detalhamento por Status Code</h3>
							</div>
							<div class="card-content">
								<div class="table-container">
									<table id="overview-table">
										<thead>
											<tr>
												<th>Status Code</th>
												<th>Contagem</th>
												<th class="text-right">Porcentagem</th>
											</tr>
										</thead>
										<tbody id="overview-tbody"></tbody>
									</table>
								</div>
							</div>
						</div>
					</div>

					<div id="overview-empty" class="empty-state hidden">
						<div class="empty-state-icon">ðŸ“Š</div>
						<p class="empty-state-text">Nenhum dado disponÃ­vel ainda.</p>
					</div>
				</div>
			</div>

			<!-- Top URLs Tab -->
			<div id="top-urls-tab" class="tab-panel">
				<div class="tab-content">
					<div class="flex items-center justify-between mb-4">
						<h2 style="font-size: 1.5rem; font-weight: 600;">URLs Mais Acessadas</h2>
						<div class="flex items-center gap-2">
							<label for="urls-limit" style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
								Mostrar:
							</label>
							<select id="urls-limit" class="select">
								<option value="10">10</option>
								<option value="25" selected>25</option>
								<option value="50">50</option>
								<option value="100">100</option>
							</select>
							<button id="urls-refresh-btn" class="btn btn-secondary">
								Atualizar
							</button>
						</div>
					</div>

					<div id="urls-loading" class="loading">
						<div class="loading-spinner"></div>
						<span style="margin-left: 0.5rem;">Carregando...</span>
					</div>

					<div id="urls-error" class="error hidden"></div>

					<div id="urls-content" class="hidden">
						<div class="card">
							<div class="card-content">
								<div class="table-container">
									<table id="urls-table">
										<thead>
											<tr>
												<th>URL</th>
												<th class="text-right">Total</th>
												<th class="text-right">Sucesso</th>
												<th class="text-right">Erros</th>
												<th class="text-right">Taxa de Sucesso</th>
												<th>Primeiro Acesso</th>
												<th>Ãšltimo Acesso</th>
											</tr>
										</thead>
										<tbody id="urls-tbody"></tbody>
									</table>
								</div>
							</div>
						</div>
					</div>

					<div id="urls-empty" class="empty-state hidden">
						<div class="empty-state-icon">ðŸ”—</div>
						<p class="empty-state-text">Nenhuma URL foi acessada ainda.</p>
					</div>
				</div>
			</div>

			<!-- Errors Tab -->
			<div id="errors-tab" class="tab-panel">
				<div class="tab-content">
					<div class="flex items-center justify-between mb-4">
						<h2 style="font-size: 1.5rem; font-weight: 600;">Rastreamento de Erros</h2>
						<div class="flex items-center gap-2">
							<label for="errors-group" style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
								Agrupar por:
							</label>
							<select id="errors-group" class="select">
								<option value="event" selected>Eventos Individuais</option>
								<option value="url">Por URL</option>
							</select>
							<label for="errors-limit" style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
								Mostrar:
							</label>
							<select id="errors-limit" class="select">
								<option value="25">25</option>
								<option value="50" selected>50</option>
								<option value="100">100</option>
								<option value="200">200</option>
							</select>
							<button id="errors-refresh-btn" class="btn btn-secondary">
								Atualizar
							</button>
						</div>
					</div>

					<div id="errors-loading" class="loading">
						<div class="loading-spinner"></div>
						<span style="margin-left: 0.5rem;">Carregando...</span>
					</div>

					<div id="errors-error" class="error hidden"></div>

					<div id="errors-content" class="hidden">
						<div class="card">
							<div class="card-content">
								<div class="table-container">
									<table id="errors-table">
										<thead>
											<tr>
												<th>Timestamp</th>
												<th>URL</th>
												<th class="text-center">Status Code</th>
												<th>Mensagem de Erro</th>
											</tr>
										</thead>
										<tbody id="errors-tbody"></tbody>
									</table>
								</div>
							</div>
						</div>
					</div>

					<div id="errors-empty" class="empty-state hidden">
						<div class="empty-state-icon">âœ…</div>
						<p class="empty-state-text">Nenhum erro registrado ainda.</p>
						<p class="empty-state-text" style="margin-top: 0.5rem;">Isso Ã© um bom sinal!</p>
					</div>
				</div>
			</div>

			<!-- Downloads Tab -->
			<div id="downloads-tab" class="tab-panel">
				<div class="tab-content">
					<div class="flex items-center justify-between mb-4">
						<h2 style="font-size: 1.5rem; font-weight: 600;">Todos os Downloads</h2>
						<button id="downloads-refresh-btn" class="btn btn-secondary">
							Atualizar
						</button>
					</div>

					<!-- Filters and Search -->
					<div class="card mb-4">
						<div class="card-content">
							<div class="flex items-center gap-3 flex-wrap">
								<!-- Search -->
								<div style="flex: 1; min-width: 250px;">
									<label for="downloads-search" style="font-size: 0.875rem; color: hsl(var(--muted-foreground)); display: block; margin-bottom: 0.25rem;">
										Pesquisa:
									</label>
									<input
										type="text"
										id="downloads-search"
										class="input"
										placeholder="Pesquisar por URL..."
									>
								</div>

								<!-- Status Range Filter -->
								<div>
									<label for="downloads-status-range" style="font-size: 0.875rem; color: hsl(var(--muted-foreground)); display: block; margin-bottom: 0.25rem;">
										Status:
									</label>
									<select id="downloads-status-range" class="select">
										<option value="">Todos</option>
										<option value="success">Sucesso (2xx)</option>
										<option value="redirect">Redirecionamento (3xx)</option>
										<option value="client-error">Erro Cliente (4xx)</option>
										<option value="server-error">Erro Servidor (5xx)</option>
									</select>
								</div>

								<!-- Sort By -->
								<div>
									<label for="downloads-sort-by" style="font-size: 0.875rem; color: hsl(var(--muted-foreground)); display: block; margin-bottom: 0.25rem;">
										Ordenar por:
									</label>
									<select id="downloads-sort-by" class="select">
										<option value="timestamp" selected>Data</option>
										<option value="url">URL</option>
										<option value="statusCode">Status Code</option>
										<option value="responseTime">Tempo de Resposta</option>
									</select>
								</div>

								<!-- Sort Order -->
								<div>
									<label for="downloads-sort-order" style="font-size: 0.875rem; color: hsl(var(--muted-foreground)); display: block; margin-bottom: 0.25rem;">
										Ordem:
									</label>
									<select id="downloads-sort-order" class="select">
										<option value="desc" selected>Decrescente</option>
										<option value="asc">Crescente</option>
									</select>
								</div>

								<!-- Page Size -->
								<div>
									<label for="downloads-page-size" style="font-size: 0.875rem; color: hsl(var(--muted-foreground)); display: block; margin-bottom: 0.25rem;">
										Por pÃ¡gina:
									</label>
									<select id="downloads-page-size" class="select">
										<option value="25" selected>25</option>
										<option value="50">50</option>
										<option value="100">100</option>
									</select>
								</div>
							</div>
						</div>
					</div>

					<div id="downloads-loading" class="loading">
						<div class="loading-spinner"></div>
						<span style="margin-left: 0.5rem;">Carregando...</span>
					</div>

					<div id="downloads-error" class="error hidden"></div>

					<div id="downloads-content" class="hidden">
						<div class="card">
							<div class="card-content">
								<div class="table-container">
									<table id="downloads-table">
										<thead>
											<tr>
												<th class="sortable" data-sort="timestamp">Timestamp</th>
												<th class="sortable" data-sort="url">URL</th>
												<th class="text-center sortable" data-sort="statusCode">Status</th>
												<th class="text-right sortable" data-sort="responseTime">Tempo (ms)</th>
												<th>User Agent</th>
												<th>Erro</th>
											</tr>
										</thead>
										<tbody id="downloads-tbody"></tbody>
									</table>
								</div>
							</div>
						</div>

						<!-- Pagination -->
						<div id="downloads-pagination" class="flex items-center justify-between mt-4">
							<div style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
								<span id="downloads-pagination-info"></span>
							</div>
							<div class="flex items-center gap-2">
								<button id="downloads-prev-btn" class="btn btn-secondary">
									Anterior
								</button>
								<span id="downloads-page-info" style="font-size: 0.875rem; padding: 0 1rem;"></span>
								<button id="downloads-next-btn" class="btn btn-secondary">
									PrÃ³xima
								</button>
							</div>
						</div>
					</div>

					<div id="downloads-empty" class="empty-state hidden">
						<div class="empty-state-icon">ðŸ“¥</div>
						<p class="empty-state-text">Nenhum download encontrado.</p>
					</div>
				</div>
			</div>

			<!-- Processing Tab -->
			<div id="processing-tab" class="tab-panel">
				<div class="tab-content">
					<div class="flex items-center justify-between mb-4">
						<h2 style="font-size: 1.5rem; font-weight: 600;">Processamento de PDFs</h2>
						<div class="flex items-center gap-2">
							<label for="processing-limit" style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
								Mostrar:
							</label>
							<select id="processing-limit" class="select">
								<option value="25">25</option>
								<option value="50" selected>50</option>
								<option value="100">100</option>
								<option value="200">200</option>
							</select>
							<button id="processing-refresh-btn" class="btn btn-secondary">
								Atualizar
							</button>
						</div>
					</div>

					<div id="processing-loading" class="loading">
						<div class="loading-spinner"></div>
						<span style="margin-left: 0.5rem;">Carregando...</span>
					</div>

					<div id="processing-error" class="error hidden"></div>

					<div id="processing-content" class="hidden">
						<!-- Overview Stats -->
						<div class="stats-grid mb-4" id="processing-stats-grid"></div>

						<!-- Errors Table -->
						<div class="card">
							<div class="card-header">
								<h3 class="card-title">Erros de Processamento</h3>
								<p class="card-description">PDFs que falharam ao ser processados pelo pdf-lib</p>
							</div>
							<div class="card-content">
								<div class="table-container">
									<table id="processing-table">
										<thead>
											<tr>
												<th>Timestamp</th>
												<th>URL</th>
												<th>Tipo de Erro</th>
												<th>Mensagem de Erro</th>
												<th class="text-right">Tempo (ms)</th>
											</tr>
										</thead>
										<tbody id="processing-tbody"></tbody>
									</table>
								</div>
							</div>
						</div>
					</div>

					<div id="processing-empty" class="empty-state hidden">
						<div class="empty-state-icon">âœ…</div>
						<p class="empty-state-text">Nenhum erro de processamento registrado.</p>
						<p class="empty-state-text" style="margin-top: 0.5rem;">Todos os PDFs foram processados com sucesso!</p>
					</div>
				</div>
			</div>

			<!-- Apps Tab -->
			<div id="apps-tab" class="tab-panel">
				<div class="tab-content">
					<div class="flex items-center justify-between mb-4">
						<h2 style="font-size: 1.5rem; font-weight: 600;">Gerenciamento de Apps</h2>
						<div class="flex items-center gap-2">
							<button id="apps-refresh-btn" class="btn btn-secondary">
								Atualizar
							</button>
							<button id="apps-create-btn" class="btn btn-primary">
								Novo App
							</button>
						</div>
					</div>

					<div id="apps-loading" class="loading">
						<div class="loading-spinner"></div>
						<span style="margin-left: 0.5rem;">Carregando...</span>
					</div>

					<div id="apps-error" class="error hidden"></div>

					<div id="apps-content" class="hidden">
						<div id="apps-cards-grid" class="apps-cards-grid">
							<!-- Cards will be rendered here by JavaScript -->
						</div>
					</div>

					<div id="apps-empty" class="empty-state hidden">
						<div class="empty-state-icon">ðŸ”‘</div>
						<p class="empty-state-text">Nenhum app cadastrado ainda.</p>
						<p class="empty-state-text" style="margin-top: 0.5rem;">Crie um app para comeÃ§ar a usar o batch processing.</p>
					</div>
				</div>
			</div>

			<!-- Create App Modal -->
			<div id="create-app-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content card">
					<div class="card-header">
						<h3 class="card-title">Criar Novo App</h3>
						<p class="card-description">Insira um nome Ãºnico para o app</p>
					</div>
					<div class="card-content">
						<form id="create-app-form">
							<div class="form-group">
								<label for="app-name-input" class="form-label">Nome do App</label>
								<input
									type="text"
									id="app-name-input"
									class="input"
									placeholder="Ex: meu-sistema-erp"
									required
									minlength="3"
									maxlength="50"
									pattern="[a-zA-Z0-9_-]+"
								>
								<p style="font-size: 0.75rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">
									Apenas letras, nÃºmeros, hÃ­fens e underscores. 3-50 caracteres.
								</p>
							</div>
							<div id="create-app-error" class="error hidden" style="margin-bottom: 1rem;"></div>
							<div class="flex items-center justify-end gap-2">
								<button type="button" id="create-app-cancel" class="btn btn-secondary">
									Cancelar
								</button>
								<button type="submit" class="btn btn-primary">
									Criar App
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>

			<!-- Token Display Modal -->
			<div id="token-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content card">
					<div class="card-header">
						<h3 class="card-title">Token Gerado</h3>
						<p class="card-description" style="color: #f59e0b;">
							Copie o token agora! Ele nÃ£o serÃ¡ exibido novamente.
						</p>
					</div>
					<div class="card-content">
						<div style="background: hsl(var(--muted)); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
							<code id="generated-token" style="word-break: break-all; font-size: 0.875rem;"></code>
						</div>
						<div class="flex items-center justify-end gap-2">
							<button id="copy-token-btn" class="btn btn-primary">
								Copiar Token
							</button>
							<button id="close-token-modal" class="btn btn-secondary">
								Fechar
							</button>
						</div>
					</div>
				</div>
			</div>

			<!-- Confirm Action Modal -->
			<div id="confirm-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content card">
					<div class="card-header">
						<h3 class="card-title" id="confirm-title">Confirmar AÃ§Ã£o</h3>
						<p class="card-description" id="confirm-description"></p>
					</div>
					<div class="card-content">
						<div id="confirm-error" class="error hidden" style="margin-bottom: 1rem;"></div>
						<div class="flex items-center justify-end gap-2">
							<button id="confirm-cancel" class="btn btn-secondary">
								Cancelar
							</button>
							<button id="confirm-action" class="btn btn-primary">
								Confirmar
							</button>
						</div>
					</div>
				</div>
			</div>

			<!-- App Details Modal -->
			<div id="app-details-modal" class="modal hidden">
				<div class="modal-backdrop"></div>
				<div class="modal-content card app-details-modal-content">
					<div class="card-header">
						<div class="flex items-center justify-between">
							<div>
								<h3 class="card-title" id="app-details-name">Nome do App</h3>
								<p class="card-description">EstatÃ­sticas detalhadas do app</p>
							</div>
							<span id="app-details-status" class="badge"></span>
						</div>
					</div>
					<div class="card-content">
						<div id="app-details-loading" class="loading hidden">
							<div class="loading-spinner"></div>
							<span style="margin-left: 0.5rem;">Carregando...</span>
						</div>

						<div id="app-details-content">
							<!-- Token Section -->
							<div class="app-details-section">
								<h4 class="app-details-section-title">Token de API</h4>
								<div class="app-details-token">
									<code id="app-details-token-value"></code>
									<button id="app-details-copy-token" class="btn btn-sm btn-secondary">Copiar</button>
								</div>
							</div>

							<!-- Stats Grid -->
							<div class="app-details-stats-grid">
								<!-- Batch Jobs Stats -->
								<div class="app-details-stats-card">
									<h4 class="app-details-stats-title">Batch Jobs</h4>
									<div class="app-details-stats-content">
										<div class="app-details-stat">
											<span class="app-details-stat-label">Total</span>
											<span class="app-details-stat-value" id="app-details-batch-total">0</span>
										</div>
										<div class="app-details-stat">
											<span class="app-details-stat-label">Completos</span>
											<span class="app-details-stat-value text-success" id="app-details-batch-completed">0</span>
										</div>
										<div class="app-details-stat">
											<span class="app-details-stat-label">Falhas</span>
											<span class="app-details-stat-value text-danger" id="app-details-batch-failed">0</span>
										</div>
										<div class="app-details-stat">
											<span class="app-details-stat-label">Parciais</span>
											<span class="app-details-stat-value text-warning" id="app-details-batch-partial">0</span>
										</div>
									</div>
								</div>

								<!-- Downloads Stats -->
								<div class="app-details-stats-card">
									<h4 class="app-details-stats-title">Downloads de PDFs</h4>
									<div class="app-details-stats-content">
										<div class="app-details-stat">
											<span class="app-details-stat-label">Total</span>
											<span class="app-details-stat-value" id="app-details-downloads-total">0</span>
										</div>
										<div class="app-details-stat">
											<span class="app-details-stat-label">Sucesso</span>
											<span class="app-details-stat-value text-success" id="app-details-downloads-success">0</span>
										</div>
										<div class="app-details-stat">
											<span class="app-details-stat-label">Erros</span>
											<span class="app-details-stat-value text-danger" id="app-details-downloads-failed">0</span>
										</div>
										<div class="app-details-stat">
											<span class="app-details-stat-label">Taxa Sucesso</span>
											<span class="app-details-stat-value" id="app-details-downloads-rate">0%</span>
										</div>
										<div class="app-details-stat">
											<span class="app-details-stat-label">Tempo MÃ©dio</span>
											<span class="app-details-stat-value" id="app-details-downloads-avg">-</span>
										</div>
									</div>
								</div>

								<!-- Processing Stats -->
								<div class="app-details-stats-card">
									<h4 class="app-details-stats-title">Processamento de PDFs</h4>
									<div class="app-details-stats-content">
										<div class="app-details-stat">
											<span class="app-details-stat-label">Total</span>
											<span class="app-details-stat-value" id="app-details-processing-total">0</span>
										</div>
										<div class="app-details-stat">
											<span class="app-details-stat-label">Sucesso</span>
											<span class="app-details-stat-value text-success" id="app-details-processing-success">0</span>
										</div>
										<div class="app-details-stat">
											<span class="app-details-stat-label">Erros</span>
											<span class="app-details-stat-value text-danger" id="app-details-processing-failed">0</span>
										</div>
										<div class="app-details-stat">
											<span class="app-details-stat-label">Taxa Sucesso</span>
											<span class="app-details-stat-value" id="app-details-processing-rate">0%</span>
										</div>
										<div class="app-details-stat">
											<span class="app-details-stat-label">Tempo MÃ©dio</span>
											<span class="app-details-stat-value" id="app-details-processing-avg">-</span>
										</div>
									</div>
								</div>
							</div>

							<!-- Info Section -->
							<div class="app-details-section">
								<h4 class="app-details-section-title">InformaÃ§Ãµes</h4>
								<div class="app-details-info-grid">
									<div class="app-details-info-item">
										<span class="app-details-info-label">Criado em</span>
										<span id="app-details-created-at">-</span>
									</div>
									<div class="app-details-info-item">
										<span class="app-details-info-label">Ãšltima atividade</span>
										<span id="app-details-last-activity">-</span>
									</div>
								</div>
							</div>

							<!-- Actions -->
							<div class="app-details-actions">
								<button id="app-details-regenerate" class="btn btn-secondary">
									Regenerar Token
								</button>
								<button id="app-details-toggle" class="btn btn-secondary">
									Desativar
								</button>
								<button id="app-details-delete" class="btn btn-destructive">
									Excluir
								</button>
							</div>
						</div>

						<div class="flex items-center justify-end mt-4">
							<button id="close-app-details-modal" class="btn btn-secondary">
								Fechar
							</button>
						</div>
					</div>
				</div>
			</div>
		</main>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
	<script src="/dashboard/js/api.js"></script>
	<script src="/dashboard/js/auth.js"></script>
	<script src="/dashboard/js/apps.js"></script>
	<script src="/dashboard/js/app.js"></script>
</body>
</html>
